<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  </head>
  <body class="px-2">
    <div class="container">
    <div class="row" style="height: 60px">
        <div class="d-flex flex-row h-100">
            <img src="logo-wolja.png" class="object-fit-contain h-100" />
            <img src="logo-uahelp.png" class="object-fit-contain h-100 ms-auto" />
        </div>
    </div>
    <h1 class="fs-3">Информация об автоматическом продлении ВНЖ по §&nbsp;24</h1>
    <div class="alert alert-info">
        <i class="bi bi-info-square-fill"></i> Информация на этой странице собрана волонтёрами. Мы не гарантируем её верность. Всю ответственность за все действия, связанные с вашими документами, несёте вы. 
    </div>
    <div class="row py-2">
        <div class="col-4">
            Параграф вашего ВНЖ:
            <button class="btn btn-sm btn-light" data-bs-toggle="collapse" data-bs-target="#infoParagraph" tabindex="-1"><i class="bi bi-question-circle"></i></button>
        </div>
        <div class="col">
            <div class="row">
                <div class="btn-group col" role="group">
                    <input type="radio" class="btn-check" name="permitParagraph" id="permitParagraph24" autocomplete="off" onchange="update()" />                
                    <label class="btn btn-outline-primary" for="permitParagraph24">§ 24</label>
                </div>
                <div class="btn-group col" role="group">
                    <input type="radio" class="btn-check" name="permitParagraph" id="permitParagraphOther" autocomplete="off" onchange="update()" />                
                    <label class="btn btn-outline-primary" for="permitParagraphOther">другой</label>
                </div>
            </div>
        </div>
    </div>
    <div id="infoParagraph" class="collapse">
        <div class="row d-flex flex-column align-items-top">
            <small>Параграф указан в виде нескольких цифр в поле Anmerkungen.</small>
            <img src="eAT-paragraph.jpg" class="mt-2" style="max-width: 500px";/>
        </div>
    </div>
    <div class="row py-2">
        <div class="col-4">
            Ваше гражданство 
        </div>
        <div class="col">
            <div class="row">
                <div class="btn-group col" role="group">
                    <input type="radio" class="btn-check" name="citizenship" id="citizenshipUkraine" autocomplete="off" onchange="showOtherCitizenOptions(); update()"/>                
                    <label class="btn btn-outline-primary" for="citizenshipUkraine">Украина</label>
                </div>
                <div class="btn-group col" role="group">
                    <input type="radio" class="btn-check" name="citizenship" id="citizenshipOther" autocomplete="off" onchange="showOtherCitizenOptions(); update()" />                
                    <label class="btn btn-outline-primary" for="citizenshipOther">другое</label>
                </div>
            </div>
        </div>
    </div>
    <div class="collapse" id="otherCitizenOptions">
        <div class="row">
            <div class="col lh-sm">
                <small>У граждан других стран для автопродления должны выполняться дополнительные условия:</small>
            </div>
        </div>
        <div class="row py-2">
            <div class="col-1">
                <input class="form-check-input  border-black" type="checkbox" id="haveRelatives" onchange="update()" />  
            </div>
            <div class="col-11">
                <label class="form-check-label" for="haveRelatives">
                    У меня есть супруг(а) или несовершеннолетние дети, которые являются гражданами Украины, получили временную защиту в Германии и живут вместе со мной
                </label>
            </div>
        </div>
        <div class="row py-2">
            <div class="col-1">
                <input class="form-check-input border-black" type="checkbox" id="haveResidence" onchange="update()" />  
            </div>
            <div class="col-11">
                <label class="form-check-label" for="haveResidence">
                    По состоянию на 24.02.2022 я постоянно проживал(а) в Украине на основании бессрочного ВНЖ (ПМЖ)
                </label>
            </div>
        </div>
    </div>

    <div class="row py-2">
        <label for="issueDate" class="form-label col-4">
            Дата выдачи ВНЖ:
            <button class="btn btn-sm btn-light" data-bs-toggle="collapse" data-bs-target="#infoIssueDate" tabindex="-1"><i class="bi bi-question-circle"></i></button>
        </label>
        <input type="text" class="form-control col mx-2" id="issueDate" placeholder="дд.мм.гггг" data-slots="дмг" onchange="update()" onkeyup="updateDebounced()" />
    </div>
    <div id="infoIssueDate" class="collapse">
        <div class="row d-flex flex-column align-items-top">
            <small>Дата выдачи указана на обратной стороне карты в поле <strong>Ausstellungsdatum</strong>.</small>
            <img src="eAT-issueDate.jpg" class="mt-2" style="max-width: 500px";/>
        </div>
    </div>
    <div class="row py-2">
        <label for="expiryDate" class="form-label col-4">
            Срок действия ВНЖ:
            <button class="btn btn-sm btn-light" data-bs-toggle="collapse" data-bs-target="#infoExpiryDate" tabindex="-1"><i class="bi bi-question-circle"></i></button>
        </label>
        <input type="text" class="form-control col mx-2" id="expiryDate" placeholder="дд.мм.гггг" data-slots="дмг" onchange="update()" onkeyup="updateDebounced()" />
    </div>
    <div id="infoExpiryDate" class="collapse">
        <div class="row d-flex flex-column align-items-top">
            <small>Дата выдачи указана на лицевой стороне карты в поле <strong>Karte gültig bis</strong>.</small>
            <img src="eAT-expiryDate.jpg" class="mt-2" style="max-width: 500px";/>
        </div>
    </div>
    <div id="alertPlaceholder" class="row">
        <div class="alert alert-info">
            <span class="me-2"><i class="bi-question-circle-fill" id="infoIcon"></i></span>
            <span>Введено недостаточно информации.</span>
        </div>
    </div>

    <div class="row letter-collapse collapse.show" id="docList">
        <p class="px-0">Приложите к письму следующие документы:</p>
        <ul>
        </ul>
        <p class="px-0"><img src="uahelp-logo-small.svg" style="height: 2ex;" /> <a class="px-0" href="https://uahelp.wiki/stuttgart/post/mail" target="_blank">UAhelp Wiki: Как правильно оформить и отправить бумажное письмо</a></p>
    </div>    

    <div class="row letter-collapse collapse" id="letterContainer">
        <div class="d-flex px-0">
            Teкст письма:
            <button type="button" class="btn btn-primary btn-sm ms-auto disabled" id="copyLetterButton"><i class="bi bi-clipboard-fill"></i> Копировать</button>
        </div>
        <textarea class="form-control" id="letter" rows="12" readonly></textarea>
    </div>

    <div class="row link-opacity-75 px-0 py-2">
        <a class="px-0" href="https://www.wolja-stuttgart.de/impressum">Impressum</a>
    </div>

    <script type="text/javascript">
        function template(strings, ...keys) {
            return (...values) => {
                const dict = values[values.length - 1] || {};
                const result = [strings[0]];
                keys.forEach((key, i) => {
                    const value = Number.isInteger(key) ? values[key] : dict[key];
                    result.push(value, strings[i + 1]);
                });
                return result.join("");
            };
        }
        
        function debounce(func, timeout = 300){
            let timer;
            return (...args) => {
                clearTimeout(timer);
                timer = setTimeout(() => { func.apply(this, args); }, timeout);
            };
        }

        const strip = (s) => s.replace(/\D/g, "");

        const E = (x) => document.getElementById(x);

        // Code thankfully borrowed from 
        // https://stackoverflow.com/a/55010378
        document.addEventListener('DOMContentLoaded', () => {
            for (const el of document.querySelectorAll("[placeholder][data-slots]")) {
                const pattern = el.getAttribute("placeholder"),
                    slots = new Set(el.dataset.slots || "_"),
                    prev = (j => Array.from(pattern, (c,i) => slots.has(c)? j=i+1: j))(0),
                    first = [...pattern].findIndex(c => slots.has(c)),
                    accept = new RegExp(el.dataset.accept || "\\d", "g"),
                    clean = input => {
                        input = input.match(accept) || [];
                        return Array.from(pattern, c =>
                            input[0] === c || slots.has(c) ? input.shift() || c : c
                        );
                    },
                    format = () => {
                        const [i, j] = [el.selectionStart, el.selectionEnd].map(i => {
                            i = clean(el.value.slice(0, i)).findIndex(c => slots.has(c));
                            return i<0? prev.at(-1) : back ? prev[i-1] || first : i;
                        });
                        el.value = clean(el.value).join("");
                        el.setSelectionRange(i, j);
                        back = false;
                    };
                let back = false;
                el.addEventListener("keydown", (e) => back = e.key === "Backspace");
                el.addEventListener("input", format);
                el.addEventListener("focus", format);
                el.addEventListener("blur", () => el.value === pattern && (el.value=""));
            }
        });

        function showOtherCitizenOptions() {
            opts = new bootstrap.Collapse("#otherCitizenOptions", {toggle: false});
            if (E("citizenshipOther").checked) {
                opts.show();
            } else {
                opts.hide();
            }
        }

        E("copyLetterButton").addEventListener("click", (event) => {
            if (E("letter").innerHTML != "") {
                navigator.clipboard.writeText(E("letter").innerHTML).then(() => {
                    const saved = event.target.innerHTML;
                    event.target.innerHTML = '<i class="bi bi-check-circle-fill"></i> Скопировано';
                    setTimeout(() => {
                        event.target.innerHTML = saved;
                    }, 3000)
                });
            }
        });

        const templateDouble = template`Sehr geehrte Damen und Herren,

das Bundesministerium des Innern und für Heimat hat am 28.11.2024 eine Verordnung erlassen, die die weitere automatische Fortgeltung der Aufenthaltstitel nach § 24 AufenthG regelt. 

Mein Aufenthaltstitel ist nach § 24 AufenthG ausgestellt, fällt unter diese Regelung und ist bis zum 04.03.2026 gültig. Dies ist folgendermaßen begründet:

1. Mein Aufenthaltstitel wurde am ${"issueDate"} ausgestellt und hat ein aufgedrucktes Gültigkeitsdatum von ${"expiryDate"}. 
2. Der Aufenthaltstitel war somit am 01.02.2024 gültig. Er fällt somit grundsätzlich unter die Ukraine-Aufenthaltserlaubnis-Fortgeltungsverordnung in der Fassung vom 28.11.2023 (BGBl. 2023 I 334, https://www.recht.bund.de/bgbl/1/2023/334/VO.html). Seine Gültigkeit wurde dadurch bis zum 04.03.2025 verlängert, ungeachtet des aufgedruckten Gültigkeitsdatums. Dadurch ist mein Aufenthaltstitel insbesondere auch als "am 01.02.2025 gültig" anzusehen.
3. Dadurch, dass mein Aufenthaltstitel zum Stichtag 01.02.2025 gültig war bzw. ist, fällt er grundsätzlich unter die UkraineAufenthFGV in der ab 28.11.2024 geltenden Fassung. Die konsolidierte Fassung ist unter https://www.gesetze-im-internet.de/ukraineaufenthfgv/BJNR14E0A0023.html abrufbar, die dazugehörige Änderungsverordnung unter BGBl. 2024 I 363, https://www.recht.bund.de/bgbl/1/2024/363/VO.html.
4. ${"citizenshipSentence"} Damit gehöre ich zu dem Personenkreis, für den nach der UkraineAufenthFGV in der Fassung vom 28.11.2024 eine weitere automatische Verlängerung des Gültigkeitsdauer des Aufenthaltstitels vorgesehen ist.
5. Damit gilt mein Aufenthaltstitel bis zum Ablauf des 04.03.2026 fort, ohne Verlängerung im Einzelfall und ungeachtet des aufgedruckten Ablaufdatums.

Mit freundlichen Grüßen`;

const templateSingle = template`Sehr geehrte Damen und Herren,

das Bundesministerium des Innern und für Heimat hat am 28.11.2024 eine Verordnung erlassen, die die automatische Fortgeltung der Aufenthaltstitel nach § 24 AufenthG regelt. 

Mein Aufenthaltstitel ist nach § 24 AufenthG ausgestellt, fällt unter diese Regelung und ist bis zum 04.03.2026 gültig. Dies ist folgendermaßen begründet:

1. Mein Aufenthaltstitel wurde am ${"issueDate"} ausgestellt und hat ein aufgedrucktes Gültigkeitsdatum von ${"expiryDate"}. 
2. Der Aufenthaltstitel ist somit am 01.02.2025 gültig. Er fällt somit grundsätzlich unter die Ukraine-Aufenthaltserlaubnis-Fortgeltungsverordnung in der Fassung vom 28.11.2024. Die konsolidierte Fassung ist unter https://www.gesetze-im-internet.de/ukraineaufenthfgv/BJNR14E0A0023.html abrufbar, die dazugehörige Änderungsverordnung unter BGBl. 2024 I 363, https://www.recht.bund.de/bgbl/1/2024/363/VO.html.
3. ${"citizenshipSentence"} Damit gehöre ich zu dem Personenkreis, für den eine weitere automatische Verlängerung des Gültigkeitsdauer des Aufenthaltstitels vorgesehen ist.
4. Damit gilt mein Aufenthaltstitel bis zum Ablauf des 04.03.2026 fort, ohne Verlängerung im Einzelfall und ungeachtet des aufgedruckten Ablaufdatums.

Mit freundlichen Grüßen`;

const templateOtherParagraph = template`Sehr geehrte Damen und Herren,

hiermit beantrage ich die Verlängerung meiner Aufenthaltserlaubnis (Kopie liegt bei).

Die Aufenthaltserlaubnis ist nach § <ПАРАГРАФ, НАПРИМЕР 33> AufenthG und nicht nach § 24 AufenthG ausgestellt. Damit fällt diese Aufenthaltserlaubnis nicht in den Geltungsbereich der Verordnung des Bundesinnenministeriums vom 28.11.2024 zur automatischen Verlängerung von Aufenthaltserlaubnissen für ukrainische Geflüchtete. Diese Verordnung gilt ausschließlich für Aufenthaltstitel nach § 24 AufenthG. Alle anderen Aufenthaltserlaubnisse sind regulär zu verlängern. 

Ich bitte Sie daher, die Aufenthaltserlaubnis zu verlängern und einen neuen elektronischen Aufenthaltstitel auszustellen. Weiterhin bitte ich Sie, eine Fiktionsbescheinigung nach § 81 Abs. 4 AufenthG auszustellen, die den Eingang dieses Antrags bestätigt.
Sollte eine persönliche Vorsprache erforderlich sein, bitte ich Sie, mir den entsprechenden Termin und Ort mitzuteilen. 

Mit freundlichen Grüßen 
`;

const templateOtherDates = template`Sehr geehrte Damen und Herren,

hiermit beantrage ich die Verlängerung meiner Aufenthaltserlaubnis (Kopie liegt bei).

Die Aufenthaltserlaubnis ist zwar nach § 24 AufenthG ausgestellt. Sie ist jedoch nur von ${issueDate} bis ${issueDate} und somit weder am 01.02.2024 noch am 01.02.2025 gültig.
Damit ist sie nicht von der automatischen Verlängerung durch die UkraineAufenthFGV erfasst. Alle Aufenthaltserlaubnisse, die davon nicht erfasst sind, sind regulär zu verlängern.

Ich bitte Sie daher, die Aufenthaltserlaubnis zu verlängern und einen neuen elektronischen Aufenthaltstitel auszustellen. Weiterhin bitte ich Sie, eine Fiktionsbescheinigung nach § 81 Abs. 4 AufenthG auszustellen, die den Eingang dieses Antrags bestätigt.
Sollte eine persönliche Vorsprache erforderlich sein, bitte ich Sie, mir den entsprechenden Termin und Ort mitzuteilen. 

Mit freundlichen Grüßen 
`;

        const DOCS = {
            FGV1: '<a href="https://www.recht.bund.de/bgbl/1/2023/334/VO.html" target="_blank">Первый раунд (2024-2025): Изначальная редакция постановления об автопродлении </a>',
            FGV2: '<a href="https://www.recht.bund.de/bgbl/1/2024/363/VO.html" target="_blank">Второй раунд (2025-2026): Постановление о продлении автопродления</a>',
            FGVС: '<a href="https://www.gesetze-im-internet.de/ukraineaufenthfgv/UkraineAufenthFGV.pdf" target="_blank">Второй раунд (2025-2026): Обновленная редакция постановления об автопродлении (PDF)</a>',
            PERMIT: 'Копию вашего ВНЖ.',
        }

        function createLetter24(issueDate, expiryDate) {
            var citizenshipSentence = "";

            if (E("citizenshipUkraine").checked) {
                citizenshipSentence = "Ich besitze die ukrainische Staatsangehörigkeit.";
            } else if (E("citizenshipOther").checked) {
                if (E("haveRelatives").checked) {
                    citizenshipSentence = "Ich gehöre der Familie eines ukrainischen Staatsangehörigen an, der in Deutschland eine Aufenthalterlaubnis nach § 24 AufenthG erhalten hat."
                } else if (E("haveResidence").checked) {
                    citizenshipSentence = "Ich habe mich am 24.02.2022 auf Grund eines unbefristeten ukrainischen Aufenthaltstitels in der Ukraine aufgehalten."
                } 
            }

            var letter = "ERROR";

            const params = {
                        issueDate: dateFns.format(issueDate, "dd.MM.yyyy"), 
                        expiryDate: dateFns.format(expiryDate, "dd.MM.yyyy"),
                        citizenshipSentence: citizenshipSentence,
                    };

            if (isEligibleByDateSingle(issueDate, expiryDate)) {
                letter = templateSingle(params)
                docList = [DOCS.FGVС]
            } else if (isEligibleByDateDouble(issueDate, expiryDate)) {
                letter = templateDouble(params)
                docList = [DOCS.FGV1, DOCS.FGV2, DOCS.FGVС]
            } else {
                letter = templateOtherDates(params)
                docList = [DOCS.PERMIT]
            }

            document.getElementById("letter").innerHTML = letter;
            E("copyLetterButton").classList.remove("disabled");

            E("docList").querySelector("ul").innerHTML = docList.map((x) => `<li class="ms-3">${x}</li>`).join("\n");
            new bootstrap.Collapse("#docList", {toggle: false}).show();
            new bootstrap.Collapse("#letterContainer", {toggle: false}).show();
        }

        function createLetterOther() {
            document.getElementById("letter").innerHTML = templateOtherParagraph();
            docList = [DOCS.PERMIT];

            E("copyLetterButton").classList.remove("disabled");
            E("docList").querySelector("ul").innerHTML = docList.map((x) => `<li class="ms-3">${x}</li>`).join("\n");

            new bootstrap.Collapse("#docList", {toggle: false}).show();
            new bootstrap.Collapse("#letterContainer", {toggle: false}).show();
        }

        function clearLetter() {
            document.getElementById("letter").innerHTML = "";
            E("copyLetterButton").classList.add("disabled");
            E("docList").querySelector("ul").innerHTML = "";
            new bootstrap.Collapse("#docList", {toggle: false}).hide();
            new bootstrap.Collapse("#letterContainer", {toggle: false}).hide();
        }

        function updateAlert(alertInfo) {
            const wrapper = E("alertPlaceholder");
            wrapper.innerHTML = [
                `<div class="alert alert-${alertInfo.type}" role="alert">`,
                `<i class="bi bi-${alertInfo.iconType}-fill me-2"></i>`,
                alertInfo.message,
                '</div>',
            ].join('')
        }

        const fgv1pivot = new Date(2024, 1, 1);
        const fgv2pivot = new Date(2025, 1, 1);

        // Be careful: issue and expiry dates of German permits are inclusive.

        function isEligibleByDateSingle(issueDate, expiryDate) {
            return (dateFns.isAfter(dateFns.add(expiryDate, {days: 1}), fgv2pivot)
                 && dateFns.isBefore(dateFns.sub(issueDate, {days: 1}), fgv2pivot))
        }

        function isEligibleByDateDouble(issueDate, expiryDate) {
            return (dateFns.isAfter(dateFns.add(expiryDate, {days: 1}), fgv1pivot)
                 && dateFns.isBefore(dateFns.sub(issueDate, {days: 1}), fgv1pivot))
        }

        function isEligibleByDate(issueDate, expiryDate) {
            return isEligibleByDateSingle(issueDate, expiryDate) || isEligibleByDateDouble(issueDate, expiryDate);
        }

        function updateByDate(issueDate, expiryDate) {
            if (isEligibleByDate(issueDate, expiryDate)) {
                updateAlert({
                    type: 'success',
                    iconType: 'check-circle',
                    message: ["Ваш ВНЖ попадает под автоматическое продление до 04.03.2026. ",
                    "Для ведомств и работодателей вы можете воспользоваться текстом письма, указанным ниже."].join(""),
                });                        
            } else {
                updateAlert({
                    type: 'warning',
                    iconType: 'exclamation-triangle',
                    message: ["Ваш ВНЖ не попадает под автоматическое продление, так как не действителен ни по состоянию на 01.02.2024, ни по состоянию на 01.02.2025.",
                                `<strong>Срок его действия истечёт ${dateFns.format(expiryDate, "dd.MM.yyyy")}.</strоng>`,
                                "Вам необходимо вовремя подать заявление о продлении ВНЖ в вашу миграционную службу.",
                                "Вы можете воспользоваться образцом заявления, указанным нижe."].join(" "),
                });                                     
            }
            createLetter24(issueDate, expiryDate);
        }

        function update() {
            const issueDate = dateFns.parse(strip(E("issueDate").value), "ddMMyyyy", new Date());
            const expiryDate = dateFns.parse(strip(E("expiryDate").value), "ddMMyyyy", new Date());

            if (E("permitParagraphOther").checked) {
                updateAlert({
                    type: 'warning',
                    iconType: 'exclamation-triangle',
                    message: ["Ваш ВНЖ не попадает под автоматическое продление, так как выдан по другому параграфу. ",
                              "Вам необходимо подать заявление о продлении ВНЖ в вашу миграционную службу до окончания срока его действия. ",
                              "Вы можете воспользоваться образцом заявления, указанным ниже, подставив туда параграф по которому выдан ваш ВНЖ."].join(""),
                });
                createLetterOther();
                return;
            }

            if (!isNaN(expiryDate) && dateFns.isAfter(expiryDate, new Date(2026, 2, 3))) {
                updateAlert({
                    type: 'success',
                    iconType: 'check-circle',
                    message: [`Ваш ВНЖ действителен до ${dateFns.format(expiryDate, "dd.MM.yyyy")}.`,
                              `По состоянию на ${dateFns.format(new Date(), "dd.MM.yyyy")} этот срок совпадает c максимально возможным сроком действия ВНЖ по § 24 AufenthG, или превышает его.`,
                              "У вас нет необходимости в автопродлении."].join(" "),
                });
                clearLetter();
                return;
            }

            if (E("permitParagraph24").checked) {
                if (E("citizenshipUkraine").checked) {
                    if (!isNaN(issueDate) && !isNaN(expiryDate)) {
                        updateByDate(issueDate, expiryDate);
                        return;
                    }
                }

                if (E("citizenshipOther").checked) {
                    if (E("haveRelatives").checked || E("haveResidence").checked) {
                        if (!isNaN(issueDate) && !isNaN(expiryDate)) {
                            updateByDate(issueDate, expiryDate);
                            return;
                        }
                    } else {
                        updateAlert({
                            type: 'danger',
                            iconType: 'exclamation-triangle',
                            message: ["Ваш ВНЖ не попадает под автоматическое продление, так как вы не входите в список категорий граждан третьих стран, претендующих на временную защиту. ",
                                      "<strong>Ваше правo пребывания в Германии заканчивается 04.03.2025.</strong>",
                                     ].join(""),
                        });
                        clearLetter();
                        return;
                    }
                }
            }

            updateAlert({
                    type: 'info',
                    iconType: 'question-circle',
                    message: ["Введено недостаточно информации. ", ].join(""),
            });
            clearLetter();
        }

        const updateDebounced = debounce(() => update());
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@3.6.0/cdn.min.js"></script>
  </body>
</html>
